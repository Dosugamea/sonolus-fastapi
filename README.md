# Sonolus-FastApi
![Python Version](https://img.shields.io/badge/python-v3.8-blue)
![License](https://img.shields.io/badge/license-AGPLv3%2B-green)

Third public Sonolus api to manage user generated background, effect, engine, level, particle and skin. Sure it accepts user upload and, able to deliver the contents to sonolus client.


## Requirements

* Poetry(>=1.16)
* Python(>=3.8.x)
* Firebase Authorization
* MariaDB Server

## Installation & Usage

To run the server, please execute the following from the root directory:

```bash
copy .env_example .env
nano .env
poetry install --no-dev
poetry run task migrate
poetry run task seed
uvicorn src.main:app --host 0.0.0.0 --port 8080
```

and open your browser at `http://localhost:8080/docs/` to see the docs.

## Running with Docker

To run the server on a Docker container, please execute the following from the root directory:

```bash
copy .env_example .env
nano .env
docker-compose up --build
```


## Development Setup

### Enable Visual Studio Code settings

```bash
cp .vscode/settings.default.json .vscode/settings.json
```

### Install dependency

development
```bash
poetry install
```

production
```bash
poetry install --no-dev
```

### Run Lint

```bash
poetry run pysen run lint
```

### Run format

```bash
poetry run pysen run format
```

### Run Test

```bash
poetry run pytest
```

### Run Development Server

```bash
poetry run task start
```

### Add package
```bash
poetry add [package name]
```

### Create database migration
```bash
alembic revision --autogenerate -m "[message]"
```

### Run database migration
```bash
alembic upgrade head
or
poetry run task migrate
```

### Run database seeding
```bash
python seeder.py
or
poetry run task seed
```

### Transfer from [sonolus-uploader-core2](https://github.com/PurplePalette/sonolus-uploader-core2)
```bash
python transfer.py
or
poetry run task transfer
```

## Powered by OpenAPI
This server was generated by the [openapi-generator](https://openapi-generator.tech) project.
By using the [OpenAPI-Spec](https://github.com/OAI/OpenAPI-Specification) from a remote server, you can easily generate a server stub. To see how to make this your own, look these: [README](https://openapi-generator.tech) / [ServerSpec](https://github.com/PurplePalette/sonolus-fastapi/blob/master/openapi.yaml) / [ServerSpec(Stoplight)](https://sonolus-core.stoplight.io/docs/sonoluscore/YXBpOjM2MTAxMzcx-sweet-potato-server-3-api)
- API version: 1.0
- Build package: org.openapitools.codegen.languages.PythonFastAPIServerCodegen
- For more information, please visit [https://discord.gg/KEfVkfC6Q9](https://discord.gg/KEfVkfC6Q9)